<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title></title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="my.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="vagga">Vagga</h1></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="the-plan">The Plan</h1><ul><li>What is vagga?</li><li>Challenges</li><li>Rust + Containers</li></ul></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="what-is-vagga">What is Vagga?</h1></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><p>vagga is...</p><h1 id="venv-nvm-rvm-on-steroids">venv/nvm/rvm on Steroids</h1></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><pre class="highlight code yaml"><span class="l-Scalar-Plain">containers</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">assets</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">setup</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="kt">!Ubuntu</span> <span class="l-Scalar-Plain">xenial</span>
    <span class="p-Indicator">-</span> <span class="kt">!Install</span> <span class="p-Indicator">[</span><span class="nv">imagemagick</span><span class="p-Indicator">,</span> <span class="nv">make</span><span class="p-Indicator">]</span>
    <span class="p-Indicator">-</span> <span class="kt">!NpmDependencies</span> <span class="s">"package.json"</span></pre></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><pre class="highlight code yaml"><span class="l-Scalar-Plain">commands</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">webpack</span><span class="p-Indicator">:</span> <span class="kt">!Command</span>
    <span class="l-Scalar-Plain">container</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">assets</span>
    <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">webpack</span><span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="kt">!Command</span>
    <span class="l-Scalar-Plain">container</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">assets</span>
    <span class="l-Scalar-Plain">environ</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">FLASK_APP</span><span class="p-Indicator">:</span> <span class="s">"myapp.py"</span> <span class="p-Indicator">}</span>
    <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="s">"python</span><span class="nv"> </span><span class="s">-m</span><span class="nv"> </span><span class="s">flask</span><span class="nv"> </span><span class="s">run"</span></pre></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><pre class="highlight code console"><span class="gp">$</span> git clone git://github.com/.../foobar
<span class="gp">$</span> <span class="nb">cd</span> foobar
<span class="gp">$</span> vagga
<span class="go">Available commands:
    build       Build static files
    run         Run nginx+app+redis
    build-docs  Build docs
</span><span class="gp">$</span> vagga build</pre></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><pre class="highlight code console"><span class="gp">$</span> git pull
<span class="gp">$</span> vagga run</pre></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><p>vagga is...</p><h1 id="the-higher-level-package-manager">The Higher Level Package Manager</h1></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><pre class="highlight code yaml"><span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">setup</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="kt">!Alpine</span> <span class="l-Scalar-Plain">v3.5</span>
  <span class="p-Indicator">-</span> <span class="kt">!Install</span> <span class="p-Indicator">[</span><span class="nv">nginx</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="kt">!Build</span>
    <span class="l-Scalar-Plain">container</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jsstatic</span>
    <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/var/javascripts</span>
    <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/srv/www</span></pre></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><pre class="highlight code yaml"><span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="kt">!Command</span>
  <span class="l-Scalar-Plain">container</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rust</span>
  <span class="l-Scalar-Plain">prerequisites</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">make-bin</span><span class="p-Indicator">,</span> <span class="nv">make-js</span><span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="s">"./target/debug/app"</span></pre></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><pre class="highlight code yaml"><span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="kt">!Supervise</span>
  <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Run full server stack</span>
  <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">redis</span><span class="p-Indicator">:</span> <span class="kt">!Command</span>
      <span class="l-Scalar-Plain">container</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">redis</span>
      <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">redis-server</span><span class="p-Indicator">,</span> <span class="nv">--daemonize</span><span class="p-Indicator">,</span> <span class="nv">no</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span> <span class="kt">!Command</span>
      <span class="l-Scalar-Plain">container</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
      <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">nginx</span><span class="p-Indicator">,</span> <span class="nv">-c</span><span class="p-Indicator">,</span> <span class="nv">/work/config/nginx.conf</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">foobar</span><span class="p-Indicator">:</span> <span class="kt">!Command</span>
      <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">python</span><span class="p-Indicator">,</span> <span class="nv">-m</span><span class="p-Indicator">,</span> <span class="nv">foobar</span><span class="p-Indicator">]</span></pre></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><p>vagga is...</p><h1 id="a-containerization-tool-without-daemons">A Containerization Tool Without Daemons</h1></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><p>[ todo ]</p></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><pre class="highlight "># docker tree
-+= 00001 root systemd --system
 |-+- 10771 root docker -d
 | \--= 32029 root bash   &lt;&lt; our process
 \-+= 30029 pc tmux
   \-+= 10718 pc -zsh     &lt;&lt; our shell
     \--= 32021 pc docker run -it --rm bash</pre><pre class="highlight "># vagga tree
-+= 00001 root systemd --system
 \-+= 30029 pc tmux
   \-+= 10358 pc -zsh        &lt;&lt; our shell
     \-+= 00940 pc vagga bash
       \-+- 00941 pc vagga bash
         \--= 00942 pc bash  &lt;&lt; our process</pre></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="id1">Vagga</h1><ul><li>simple YAML config (+versioning)</li><li>user namespaces (no root/setuid)</li><li>multiple process monitoring</li><li>only for dev.env.</li></ul><p>(written in rust)</p></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="challenges">Challenges</h1></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="pid1">PID1</h1><ul><li>KILL</li><li>Signals</li><li>Reparenting</li></ul><p>(remember <tt>tini</tt>?)</p></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="after-clone">After Clone</h1><ul><li>No memory allocations</li><li>more things allocate in debugging version than in release</li></ul></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="cloexec">Cloexec</h1><ul><li>Cloexec by default</li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>